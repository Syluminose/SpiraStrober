<!DOCTYPE html><meta charset="utf-8"><script>
// MIT License ¬© 2025 Syluminose - Modified for Pivot/Beat ranges
let d=document,c=z=>d.createElement(z),e=d.documentElement,s=[],E=[],pb=[],GB=[],SB=null,Ct='#fffd',RM_T=null,RM_I=-1,$cancelToken=0,C$=cT=>{if(cT!==$cancelToken)throw'A'},{max:ma,min:mi,sin:sn,cos:cs,random:rn,abs:ab,PI:pi}=Math,tp=pi*2,SR=44100,FC=[18700,19200,19700,19200],go=f=>{s.length&&(f(),At())},sE=f=>{f();At()},gR=t=>t.getBoundingClientRect(),W=(t,a)=>t.textContent=a,C=(t,k)=>t.style.cssText=k,mk=(l,x,t)=>{let o=c(l);x&&W(o,x);t&&C(o,t);return o},ap=(p,...a)=>p.append(...a),ev=(l,n,f)=>l['on'+n]=f,EM=['‚è≥','üîî','‚ö°','üåä','üí´','‚ú®'],BT=['üî∂','üîÅ','‚òÄÔ∏è','üé≤','ü™á','ü™©','‚ùå','+'],C1='white-space:pre;color:',BR='border-radius:1vmin;',CU='cursor:pointer;',FS='font-size:',W1='width:100%;',PD='padding:1vmin;',P5='padding:0.5vmin;',G1='gap:1vmin;',S1=FS+'2vmin;',FW='font-weight:bold;',S2=FS+'4vmin;',S0=FS+'3vmin;'+FW,D='display:flex;',ICO=CU+S2,IB=ICO+C1+'#000;',IR=ICO+C1+'#f44;',IY=ICO+C1+'#fb4;',IG=ICO+C1+'#4f4;',IM=D+'justify-content:center;align-items:center;min-width:8.5vmin;height:8vmin;',S3=D+'justify-content:center;'+G1+PD,S4=D+'align-items:center;'+G1+'overflow-x:auto;',S5B='position:relative;'+CU+P5+BR+C1+'#000;'+D+'flex-direction:column;align-items:center;justify-content:center;text-align:center;background:'+Ct+';',S5=S5B+'height:8vmin;',S5G=S5B+'height:12vmin;',S6='position:fixed;left:5vmin;width:90vmin;z-index:1000;background:'+Ct+';'+BR+PD+'display:none;max-height:80vh;overflow-y:auto;',S9='position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:90vmin;background:#000;color:#fff;'+PD+BR+S1+'z-index:1001;white-space:pre-line;border:2px solid #fb4',
FP={p:[
  [EM[0],[0,300],[60,60],1,'Duree(s)',0],
  [EM[1],[0,40],[10,20],[-10,10],[-2,2],.1,'Freq(Hz)',1],
  [EM[2],[-.5,.5],[0,0],[-1,1],[0,0],.01,'Phase(tours)',1],
  [EM[3],[0,10],[0,10],[-10,10],[0,0],.1,'OscAmp(Hz)',1],
  [EM[4],[0,1],[0,1],[-1,1],[0,0],.01,'OscFreq(Hz)',1],
  [EM[5],[-.5,.5],[0,0],[-1,1],[0,0],.01,'PhaseOsc(tours)',1]
]},
PL=[-.33,0,.33],PR=[-.33,0,.33],MD=0,hM=(x,y)=>ma(0,mi(270,ab(x-y)*9)),G=i=>`hsl(${hM(s[i][0][1],s[i][1][1])},100%,50%)`,hG=(f,k,i,l)=>{let [s0,s1,s2,s3]=[s[i][k][1],s[i+1][k][1],s[i][k+1][1],s[i+1][k+1][1]];return`hsl(${hM(s0+(s1-s0)*f,s2+(s3-s2)*f)},100%,${l}%)`},H=(i,l)=>i>=s.length-1?`hsl(${hM(s[i][0][1],s[i][1][1])},100%,${l}%)`:`linear-gradient(to bottom,${Array.from({length:9},(_,j)=>hG(j/8,0,i,l)).join(',')})`,
IX=r=>{let l=r.length;return{ty:r[l-1],lb:r[l-2],st:r[l-3],gl:r[1],rp:r[2],gb:l>6?r[3]:r[1],rb:l>6?r[4]:r[2]}},
gr=(rg,st)=>(st>=1)?~~(rn()*(rg[1]-rg[0]+1))+rg[0]:+(rn()*(rg[1]-rg[0])+rg[0]).toFixed(st.toString().split('.')[1]?.length||0),
rv=()=>FP.p.reduce((a,p)=>{
  let {ty,st,rp,rb}=IX(p),v=[];
  if(ty===0){
    let g=gr(rp,st);v=[g,g,g,g,g,g];
  }else{
    for(let k=0;k<3;k++){let P=gr(rp,st),B=gr(rb,st);v.push(P-B/2,P+B/2);}
  }
  v.forEach((x,i)=>a[i].push(x));return a;
},Array.from({length:6},()=>[])),
rvS=()=>{let a=rv();[0,2,4].forEach((i,k)=>a[i][5]=PL[k]);[1,3,5].forEach((i,k)=>a[i][5]=PR[k]);return a},cp=a=>structuredClone(a),
FX=sg=>{let fg=sg[2][1],fd=sg[3][1];sg[0][1]=fg;sg[4][1]=fg;sg[1][1]=fd;sg[5][1]=fd},
UN=sg=>{[0,2,4].forEach(k=>sg[k+1][1]=sg[k][1])},
PO=sg=>{[0,2,4].forEach((ix,k)=>sg[ix][5]=PL[k]);[1,3,5].forEach((ix,k)=>sg[ix][5]=PR[k])},
sw=a=>{FP.p.forEach((r,k)=>{let {ty}=IX(r);if(ty&&k)[0,2,4].forEach(b=>{[a[b][k],a[b+1][k]]=[a[b+1][k],a[b][k]]})});return a},
uP=(sg,j,k,v)=>{let ci=~~(k/2),si=k%2,P=v,B=si==1?v:sg[ci*2+1][j]-sg[ci*2][j];si==1&&(B=v,P=(sg[ci*2][j]+sg[ci*2+1][j])/2);sg[ci*2][j]=P-B/2;sg[ci*2+1][j]=P+B/2},
dL=(i,p,l1,sr)=>{let b=s[i],r=FP.p[p],{ty}=IX(r);if(MD==0){if(ty==1){l1&&(l1.innerHTML=b.slice(0,6).map((c,x)=>x%2?'':fx(c[p])+' '+fx(s[i][x+1][p])).filter(Boolean).join('<br>'));C(l1,'display:block;text-align:center;line-height:1.2;white-space:nowrap;');sr&&C(sr,'display:none')}else{let [lv,rv]=[b[0][p],b[1][p]];l1&&W(l1,fx(lv));sr&&(W(sr,(ty||lv!=rv)?fx(rv):''),C(sr,'display:'+((ty||lv!=rv)?'block':'none')))}}else{let P=[(b[0][p]+b[1][p])/2,(b[2][p]+b[3][p])/2,(b[4][p]+b[5][p])/2],B=[b[1][p]-b[0][p],b[3][p]-b[2][p],b[5][p]-b[4][p]];l1&&(l1.innerHTML=P.map((pv,x)=>fx(pv)+' '+fx(B[x])).join('<br>'));C(l1,'display:block;text-align:center;line-height:1.2;white-space:nowrap;');sr&&C(sr,'display:none')}},
U,mo,sl=[],ga=[],cv,zm,if$,zo=0,zs=1,dt=[],gl,g2,pg,p2,rH=null,T$=()=>s.slice(0,-1).reduce((a,b)=>a+b[0][0],0),ti=(T,z)=>`t=${(zo*T).toFixed(2)}s-${((zo+zs)*T).toFixed(2)}s${z?' Zoom√ó'+(1/zs).toFixed(1):''}`,fx=v=>v.toFixed(v==~~v?0:v*10==~~(v*10)?1:2),wI=()=>new Promise(r=>window.requestIdleCallback?requestIdleCallback(r):setTimeout(r,0)),qR=f=>{rH&&cancelIdleCallback(rH);rH=requestIdleCallback(()=>{f();rH=null})},Li=(a,b,t,T)=>a+(b-a)*t/T,In=(a,b,t,T)=>a*t+(b-a)*t*t/(2*T),Sl=(a,b,T)=>(b-a)/T,cO=(o0,o1,p0,p1,t,T,hO)=>tp*(hO+In(o0,o1,t,T)+Li(p0,p1,t,T)),cSi=(f0,f1,h0,h1,a0,a1,o0,o1,t,T,Oi,hM)=>sn(tp*(hM+In(f0,f1,t,T)+Li(h0,h1,t,T)+Li(a0,a1,t,T)/(Li(o0,o1,t,T)*4*pi||1e-9)*Oi)),cFi=(f0,f1,h0,h1,a0,a1,o0,o1,t,T,Oi)=>Li(f0,f1,t,T)+Sl(h0,h1,T)+Li(a0,a1,t,T)/2*Oi,cKi=(f0,f1,a0,a1,o0,o1,t,T,Oi)=>Sl(f0,f1,T)-Li(a0,a1,t,T)*Li(o0,o1,t,T)*pi*Oi,cV=(f0,f1,h0,h1,a0,a1,o0,o1,p0,p1,t,T,hO,hM,fi)=>{let Ag=cO(o0,o1,p0,p1,t,T,hO),Os=sn(Ag),Oc=cs(Ag);if(fi==1)return cSi(f0,f1,h0,h1,a0,a1,o0,o1,t,T,Os,hM);if(fi==2)return cFi(f0,f1,h0,h1,a0,a1,o0,o1,t,T,Oc);return cKi(f0,f1,a0,a1,o0,o1,t,T,Os);},cS=(tg,of,n,f0,f1,T,h0,h1,a0,a1,o0,o1,p0,p1,hO,hM,fi)=>{let dt=T/n,mn=1e9,mx=-1e9;for(const i of Array(n).keys()){let t=i*dt,vl=cV(f0,f1,h0,h1,a0,a1,o0,o1,p0,p1,t,T,hO,hM,fi);tg[of+i]=vl;if(fi!=1){mn=mi(mn,vl);mx=ma(mx,vl);}}return {mn,mx};},gD=async(n,T,ss,kS,fi,fC,cT,oP)=>{let ds=Array(2).fill().map(()=>[]),st=Array(2).fill().map(()=>new Float32Array(n)),sm=fi==1?Array(2).fill().map(()=>new Float32Array(n)):null,to=0,ph=[0,0],cP=fi==1?[0,0]:null,hC=[0,0],hM=[0,0],mn=fi==1?[-1,-1]:[1e9,1e9],mx=fi==1?[1,1]:[-1e9,-1e9],ln=ss.length-1,pC=fi==1?tp*fC/SR:0;for(let ix=0;ix<ln;ix++){C$(cT);let sg=ss[ix],sn$=ss[ix+1],dT=sg[0][0],ns=~~(n*dT/T);for(let k=0;k<2;k++){let p=sg[kS+k],nv=sn$[kS+k],{mn:da_mn,mx:da_mx}=cS(st[k],to,ns,p[1],nv[1],dT,p[2],nv[2],p[3],nv[3],p[4],nv[4],p[5],nv[5],hC[k],hM[k],fi);if(fi==1)for(let i=0;i<ns;i++){sm[k][to+i]=st[k][to+i]*sn(cP[k]);cP[k]+=pC;cP[k]>=tp&&(cP[k]-=tp)}else{mn[k]=mi(mn[k],da_mn);mx[k]=ma(mx[k],da_mx)}hC[k]+=In(p[4],nv[4],dT,dT);hM[k]+=In(p[1],nv[1],dT,dT);}to+=ns;oP&&(await wI(),C$(cT),oP(ix/ln));}C$(cT);let gm=[mi(...mn),ma(...mx)],ri=65535/(gm[1]-gm[0]||1);ds.forEach((d,k)=>{let pU=new Uint16Array(n);for(let i=0;i<n;i++)pU[i]=ma(0,mi(65535,~~((st[k][i]-gm[0])*ri)));d.push(fi==1?{p:pU,gm,f:sm[k]}:{p:pU,gm})});return ds.map(d=>d[0])},DC=async(n,T,ss,cT,oP)=>{let dr=[],dS=[],dF=[],dC=[],cM=['R','V','B'],cL=['signal','fr√©quence','chirp'];for(let c=0;c<3;c++){C$(cT);dS.push(...await gD(n,T,ss,c*2,1,FC[c],cT,oP&&(p=>oP(.1+c*.033+.033*p*.33,`Calcul ${cL[0]} ${cM[c]} ${~~(p*100)}%`))));C$(cT);dF.push(...await gD(n,T,ss,c*2,2,null,cT,oP&&(p=>oP(.2+c*.033+.033*p*.33,`Calcul ${cL[1]} ${cM[c]} ${~~(p*100)}%`))));C$(cT);dC.push(...await gD(n,T,ss,c*2,3,null,cT,oP&&(p=>oP(.3+c*.033+.033*p*.33,`Calcul ${cL[2]} ${cM[c]} ${~~(p*100)}%`))));}[dS,dF,dC].forEach(ds=>dr.push(ds[0],ds[2],ds[4],ds[1],ds[3],ds[5]));return dr},iG=ca=>{let g=ca.getContext('webgl2',{alpha:!1,antialias:!0,preserveDrawingBuffer:!0});if(!g)return null;let vs=g.createShader(g.VERTEX_SHADER),fs=g.createShader(g.FRAGMENT_SHADER);g.shaderSource(vs,'#version 300 es\nin vec2 p;void main(){gl_Position=vec4(p,0,1);}');g.shaderSource(fs,'#version 300 es\nprecision mediump float;uniform vec3 c;out vec4 fragColor;void main(){fragColor=vec4(c,1);}');[vs,fs].forEach(sh=>g.compileShader(sh));if(![vs,fs].every(sh=>g.getShaderParameter(sh,g.COMPILE_STATUS)))return null;let pg=g.createProgram();[vs,fs].forEach(sh=>g.attachShader(pg,sh));g.linkProgram(pg);return g.getProgramParameter(pg,g.LINK_STATUS)?{g,pg}:null},dr=(ca,os,z,T,iZ)=>{let r=gR(ca),dp=devicePixelRatio,w=r.width*dp,h=r.height*dp;ca.width=w;ca.height=h;let g=iZ?g2:gl,pg$=iZ?p2:pg;if(!g){let in$=iG(ca);if(!in$)return;g=in$.g;pg$=in$.pg;iZ?(g2=g,p2=pg$):(gl=g,pg=pg$)}g.viewport(0,0,w,h);g.clearColor(os?0:.067,os?0:.067,os?0:.067,1);g.clear(g.COLOR_BUFFER_BIT);if(!dt.length)return;g.useProgram(pg$);let lw=iZ?8:1,pL=g.getAttribLocation(pg$,'p'),cL=g.getUniformLocation(pg$,'c'),hS=h/18,cM=[[1,.27,.27],[.27,1,.27],[.27,.27,1]];dt.forEach((d,gi)=>{g.lineWidth(gi>=6&&gi<=17&&!iZ?4:lw);let st=~~(os*d.p.length),ed=mi(d.p.length,~~((os+z)*d.p.length)),zp=os?d.p.subarray(st,ed):d.p,yB=gi*hS,dL=zp.length,pd=zp,mS=w*2;if(dL>mS){let sp=~~(dL/mS);pd=new Uint16Array(~~(dL/sp));for(let i=0;i<pd.length;i++)pd[i]=zp[i*sp]}let rL=pd.length*2;(!SB||SB.length<rL)&&(SB=new Float32Array(rL));let vt=SB.subarray(0,rL),pL$=pd.length-1||1;for(let i=0;i<pd.length;i++){vt[i*2]=i/pL$*2-1;vt[i*2+1]=1-(yB+hS-pd[i]/65535*hS)/h*2}let bf=d.buffer,vL=vt.length;if(!bf||d.vL!==vL){bf&&g.deleteBuffer(bf);bf=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,bf);g.bufferData(g.ARRAY_BUFFER,vt,g.DYNAMIC_DRAW);d.buffer=bf;d.vL=vL}else{g.bindBuffer(g.ARRAY_BUFFER,bf);g.bufferSubData(g.ARRAY_BUFFER,0,vt)}g.enableVertexAttribArray(pL);g.vertexAttribPointer(pL,2,g.FLOAT,!1,0,0);g.uniform3fv(cL,cM[gi%3]);g.drawArrays(g.LINE_STRIP,0,pd.length)})},J=async()=>{let Tt=T$();$cancelToken++;const cT=$cancelToken;if(!mo){mo=mk('div','','position:relative;width:100%;height:25vh;background:#000;color:#fff;border-top:2px solid #fff;');cv=mk('canvas','','border:1px solid #fb4;'+W1+'height:100%;display:block;');zm=mk('canvas','',W1+'height:100%;display:block;min-height:0;background:#000');if$=mk('div',ti(Tt),'position:absolute;top:0.2vmin;right:0.5vmin;color:#fb4;'+S1+'pointer-events:none;z-index:101');let ct=mk('div','',W1+'height:100%;position:relative;min-height:0');ap(ct,if$,cv);ap(mo,ct);ev(cv,'click',()=>{if(d.querySelector('.zoom-window'))return;let T=T$(),zM=mk('div','','position:fixed;top:26vh;left:0vmin;width:100vw;height:25vh;background:#000;color:#fff;'+BR+S1+'z-index:1001;'+D+'flex-direction:column;align-items:center;border:2px solid #fb4'),zW=mk('div','',W1+'height:100%;position:relative;min-height:0;');zM.classList.add('zoom-window');let cl=mk('div','‚ùå','position:absolute;top:0.5vmin;right:0.5vmin;'+IR+'z-index:102');ev(cl,'click',()=>zM.remove());let zI=mk('div',ti(T,1),'position:absolute;top:2vmin;right:5vmin;color:#fb4;'+S1+'pointer-events:none;z-index:102');ap(zW,zm,zI,cl);ap(zM,zW);ap(d.body,zM);dr(zm,zo,zs,T,!0);let um=e=>{let rt=gR(e.target),x=((e.touches?.[0]??e).clientX-rt.left)/rt.width,T=T$();zo=ma(0,mi(1-zs,x-zs/2));dr(zm,zo,zs,T,!0);W(zI,ti(T,1))};ev(zm,'mousemove',um);ev(zm,'touchmove',um);ev(zm,'wheel',e=>{e.preventDefault();let nz=ma(.01,mi(1,zs*(1+e.deltaY*-.001))),T=T$();zo=ma(0,mi(1-nz,zo+(zs-nz)/2));zs=nz;dr(zm,zo,zs,T,!0);W(zI,ti(T,1))})})};zs=1/Tt;zo=0;try{dt=await DC(~~(Tt*441),Tt,s,cT,p=>W(if$,`‚è≥ ${~~((p-.1)/.3*100)}% - ${p<.4?'Calcul courbes':p}`));queueMicrotask(()=>{dr(cv,0,1,Tt);dr(zm,zo,zs,Tt,!0);W(if$,ti(Tt))});}catch(e){if(e==='A'){W(if$,'‚ùå Annul√©');return}throw e}},rg=(n,x,t,v)=>Object.assign(c('input'),{type:'range',value:v,min:n,max:x,step:t,style:'width:100%;margin:0',onclick:e=>e.stopPropagation()}),
gS_=(r,ib)=>{let {gl,gb,st}=IX(r);return{mn:(ib?gb:gl)[0],mx:(ib?gb:gl)[1],st}},
gL=(r,j,k,v,m)=>j==0?{tx:`${EM[j]} ${fx(v)}`}:m==0?{tx:`${['üî¥','üü¢','üîµ'][~~(k/2)]}${['G','D'][k%2]} ${fx(v)}`}:{tx:`${['üî¥','üü¢','üîµ'][~~(k/2)]}${['P','B'][k%2]} ${fx(v)}`},bF=(tx,sl,sp,uSV)=>{let b=mk('div',tx,S0+CU+'width:5vmin;text-align:center;');ev(b,'click',e=>{e.stopPropagation();uSV(+sl.value+(tx.includes('‚´∑')?-10:tx.includes('‚´∏')?10:tx.includes('‚™°')?-1:1)*sp)});return b},
cS$=(r,j,k,v,m,uFx)=>{let sp=gS_(r,m==1&&k%2),step=sp.st,prec=(step.toString().split('.')[1]?.length||0),lb=gL(r,j,k,v,m),lT=mk('div',lb.tx,S0+'text-align:center;flex-grow:1;'),sl=rg(sp.mn,sp.mx,step,v),aC=mk('div','',D+'justify-content:space-between;align-items:center;'),uSV=nv=>{nv=ma(sp.mn,mi(sp.mx,nv));nv=parseFloat(nv.toFixed(prec));sl.value=nv;W(lT,gL(r,j,k,nv,m).tx);uFx(nv)};ev(sl,'input',()=>uSV(+sl.value));ap(aC,bF('‚´∑',sl,step,uSV),bF('‚™°',sl,step,uSV),lT,bF('‚™¢',sl,step,uSV),bF('‚´∏',sl,step,uSV));let ct=mk('div','',D+'flex-direction:column;'+G1);ap(ct,aC,sl);return {container:ct,lT,sl};},uL=(i,p,l1)=>{l1&&dL(i,p,l1,l1.nextElementSibling);uc();uW();qR(()=>mo&&J())},uW=()=>{let cW=new Array(6).fill(0);pb.forEach(btn=>{btn.style.width='';btn.style.minWidth=''});pb.forEach((btn,k)=>{let w=btn.offsetWidth,j=k%6;w>cW[j]&&(cW[j]=w)});pb.forEach((btn,k)=>{let j=k%6,mW=cW[j];if(!mW)return;let pW=(ma(mW/e.clientWidth*100,7)).toFixed(2)+'vmin';btn.style.width=pW;btn.style.minWidth=pW})},hS=e=>{ga.forEach(el=>el.style.display='none');sl.forEach(r=>r.forEach(el=>el.style.display='none'));d.querySelectorAll('.menu-modifier,.menu-ajouter').forEach(el=>el.style.display='none')},cI_s=(r,j,v,sd,uFx)=>{let ct1=mk('div','',D+'flex-direction:column;flex:1;'+G1),t1=mk('div','Valeur',C1+'#4af;font-weight:bold;'+S1);ap(ct1,t1);let {container}=cS$(r,j,0,v,0,uFx);ap(ct1,container);ap(sd,ct1);ev(sd,'click',e=>e.stopPropagation());return ()=>sd.style.display='none'},cI=(r,j,vs,vs2,sd)=>{if(j===0){const uF=(v)=>{s.forEach(c=>c.forEach(p=>p[j]=v));At();qR(()=>mo&&J())};return cI_s(r,j,vs[0],sd,uF)}let dG=mk('div','',D+'gap:2vmin;'),ct1=mk('div','',D+'flex-direction:column;flex:1;'+G1),ct2=mk('div','',D+'flex-direction:column;flex:1;'+G1),t1=mk('div','G/D',C1+'#4af;font-weight:bold;'+S1),t2=mk('div','P/B',C1+'#4f4;font-weight:bold;'+S1);ap(ct1,t1);ap(ct2,t2);const uFg=(k)=>(v)=>{let {ty}=IX(r);if(ty===1){s.forEach(sg=>sg[k][j]=v)}else{!ty&&s.forEach(c=>c.forEach(p=>p[j]=v))}At();qR(()=>mo&&J())};const uFp=(k)=>(v)=>{s.forEach(sg=>uP(sg,j,k,v));At();qR(()=>mo&&J())};vs.forEach((v,k)=>{let {container}=cS$(r,j,k,v,0,uFg(k));ap(ct1,container)});vs2.forEach((v,k)=>{let {container}=cS$(r,j,k,v,1,uFp(k));ap(ct2,container)});ap(dG,ct1,ct2);ap(sd,dG);ev(sd,'click',e=>e.stopPropagation());return ()=>sd.style.display='none';},bs_s=(r,j,b,i,l1,sd)=>{let v=b[0][j];const uF=(v)=>{s[i].forEach(c=>c[j]=v)},ct1=mk('div','',D+'flex-direction:column;flex:1;'+G1),t1=mk('div','Valeur',C1+'#4af;font-weight:bold;'+S1);ap(ct1,t1);const uFx=(v)=>{uF(v);uL(i,j,l1)};let {container}=cS$(r,j,0,v,0,uFx);ap(ct1,container);ap(sd,ct1);ev(sd,'click',e=>e.stopPropagation());return ()=>sd.style.display='none'},
bs=(r,j,b,i,l1,sr,w,sd)=>{let {ty}=IX(r);if(j===0)return bs_s(r,j,b,i,l1,sd);let iv=ty===1?b.map(x=>x[j]):[b[0][j],b[1][j]],iv2=[(b[0][j]+b[1][j])/2,b[1][j]-b[0][j],(b[2][j]+b[3][j])/2,b[3][j]-b[2][j],(b[4][j]+b[5][j])/2,b[5][j]-b[4][j]],sls1=[],lTs1=[],sls2=[],lTs2=[],refreshOpposite=(sourceIsGD)=>{let b=s[i];if(sourceIsGD){let iv2_recalc=[(b[0][j]+b[1][j])/2,b[1][j]-b[0][j],(b[2][j]+b[3][j])/2,b[3][j]-b[2][j],(b[4][j]+b[5][j])/2,b[5][j]-b[4][j]];iv2_recalc.forEach((v,k)=>{let sl=sls2[k],lT=lTs2[k];sl.value=v;W(lT,gL(r,j,k,v,1).tx);});}else{[b[0][j],b[1][j],b[2][j],b[3][j],b[4][j],b[5][j]].forEach((v,k)=>{let sl=sls1[k],lT=lTs1[k];sl.value=v;W(lT,gL(r,j,k,v,0).tx);});}},uFg=(k)=>(v)=>{let {ty}=IX(r);if(ty===1){s[i][k][j]=v}else{j===0&&k===0?s[i].forEach(c=>c[j]=v):s[i][k][j]=v}refreshOpposite(true);uL(i,j,l1);},uFp=(k)=>(v)=>{uP(s[i],j,k,v);refreshOpposite(false);uL(i,j,l1);};let dG=mk('div','',D+'gap:2vmin;'),ct1=mk('div','',D+'flex-direction:column;flex:1;'+G1),ct2=mk('div','',D+'flex-direction:column;flex:1;'+G1),t1=mk('div','G/D',C1+'#4af;font-weight:bold;'+S1),t2=mk('div','P/B',C1+'#4f4;font-weight:bold;'+S1);ap(ct1,t1);ap(ct2,t2);iv.forEach((v,k)=>{let {container:ct,lT,sl}=cS$(r,j,k,v,0,uFg(k));sls1.push(sl);lTs1.push(lT);ap(ct1,ct)});iv2.forEach((v,k)=>{let {container:ct,lT,sl}=cS$(r,j,k,v,1,uFp(k));sls2.push(sl);lTs2.push(lT);ap(ct2,ct)});ap(dG,ct1,ct2);ap(sd,dG);ev(sd,'click',e=>e.stopPropagation());return ()=>sd.style.display='none';},
gT=(r,j)=>{let {lb,ty}=IX(r),hL=lb,m=hL.match(/(.*)(\(.*\))$/);if(m){let lB=m[1],uN=m[2];if(j>=3&&j<=5){let pS=[];if(lB.includes('Osc')){pS.push('Osc');pS.push(lB.replace('Osc',''));}else{pS.push(lB);}hL=pS.filter(p=>p.length).join('<br>')+'<br>'+uN;}else hL=lB+'<br>'+uN;}let ig=ty==1?Array(6).fill(r[1][0]):[r[1][0],r[1][0]],ig2=[(r[1][0]+r[1][0])/2,(r[1][0]+r[1][0])/2,(r[1][0]+r[1][0])/2,0,0,0];return {hL,ig,ig2};},gP=(p,r,j,i,b,isG)=>{let w=mk('div','',isG?S5G:S5);isG?w.classList.add('global-item'):w.classList.add('menu-item');let l1=c('div'),sr=c('div'),sd=mk('div','',S6);isG?ga[j]=sd:sl[i][j]=sd;let initFunc=null;if(isG){let {hL,ig,ig2}=gT(r,j);let l3=mk('div',r[0],S2);let val1=mk('div','',S1+C1+'#000;');val1.innerHTML=hL;initFunc=()=>cI(r,j,ig,ig2,sd);ap(w,l3,val1,sd);}else{[l1,sr].forEach(el=>C(el,S1+C1+'#000'));dL(i,j,l1,sr);initFunc=()=>bs(r,j,b,i,l1,sr,w,sd);ap(w,l1,sr,sd);}initFunc();ev(w,'click',e=>{e.stopPropagation();hS();let r$=gR(w);sd.style.top=(r$.bottom+5)+'px';sd.style.display='block'});ap(p,w);pb.push(w);return w;},K=()=>{let g=mk('div','','position:sticky;top:0;left:0;right:0;z-index:999;background:linear-gradient(45deg,#ff0,#f0f,#0ff,#0f0);'+PD+S1),h=mk('div','',D+'justify-content:space-between;align-items:center;'),ht=mk('div','üåàSpiraStrober',C1+'#000;'+S2+'cursor:default;'),hb=mk('div','',D+G1);BT.slice(0,6).forEach((em,i)=>{let b=mk('div',em,IB);ev(b,'click',[()=>go(()=>s.forEach((g,k)=>k&&(s[k]=cp(s[0])))),()=>go(()=>s.forEach((g,k)=>{if(k){let n=cp(s[0]);k%2&&(n=sw(n));s[k]=n}})),()=>go(()=>s.forEach(FX)),()=>go(()=>s.forEach((_,k)=>s[k]=rv())),()=>go(()=>s.forEach(UN)),()=>go(()=>s.forEach(PO))][i]);ap(hb,b)});ap(h,ht,hb);let p=mk('div','',S4);FP.p.forEach((r,j)=>{let w=gP(p,r,j,null,null,true);GB.push(w);});let wM=mk('div','',S5G+D+'flex-direction:row;gap:0.5vmin;'),bd=mk('div','üîª',ICO),bu=mk('div','üî∫',ICO),br=mk('div','‚ôªÔ∏è',ICO);ap(wM,bd,bu,br);ap(p,wM);ap(g,h,p);return g},L=i=>{let a=['div','h1','h2','p','div'].map(c),b=s[i],cl=G(i),gr=H(i,50);C(a[0],`border:0;border-radius:0;background:${gr};${P5}position:relative;${S1}`+D+'align-items:center;justify-content:space-between;gap:0.5vmin;');let aM=[()=>i&&sE(()=>s[i]=cp(s[i-1])),()=>sE(()=>s[i]=sw(cp(s[i]))),()=>sE(()=>FX(s[i])),()=>sE(()=>s[i]=rv()),()=>sE(()=>UN(s[i])),()=>sE(()=>PO(s[i]))],aD=()=>s.length>1&&sE(()=>s.splice(i,1)),S4S=D+'align-items:center;'+G1+'overflow-x:auto;flex-grow:1;min-width:0;',pd=mk('div','',S4S);sl[i]=[];FP.p.forEach((r,j)=>{gP(pd,r,j,i,b,false)});let sW='position:absolute;top:0;right:0;width:28vmin;background:'+Ct+';'+BR+'z-index:10;'+D+'flex-wrap:wrap;align-items:center;justify-content:space-around;padding:1vmin;gap:1vmin;display:none;',cM=mk('div','',sW);cM.classList.add('menu-ajouter');let bA=[()=>sE(()=>s.splice(i+1,0,cp(s[i]))),()=>sE(()=>s.splice(i+1,0,sw(cp(s[i])))),()=>sE(()=>{let a=rv();FX(a);s.splice(i+1,0,a)}),()=>sE(()=>s.splice(i+1,0,rv())),()=>sE(()=>{let a=rv();UN(a);s.splice(i+1,0,a)}),()=>sE(()=>s.splice(i+1,0,rvS()))];BT.slice(0,6).forEach((em,k)=>{let b=mk('div',em,IG+IM);ev(b,'click',e=>{e.stopPropagation();RM_T='cM';RM_I=i;bA[k]()});ap(cM,b)});let mM=mk('div','',sW);mM.classList.add('menu-modifier');BT.slice(0,6).forEach((em,k)=>{let b=mk('div',em,IY+IM);ev(b,'click',e=>{e.stopPropagation();RM_T='mM';RM_I=i;aM[k]()});ap(mM,b)});let wA=mk('div','',S5+D+'flex-direction:row;gap:0.5vmin;flex-shrink:0;'),bD=mk('div',BT[6],IR);C(bD,`opacity:${s.length<=1?.3:1};${bD.style.cssText}`);ev(bD,'click',aD);let bM=mk('div','üìù',IR);ev(bM,'click',e=>{e.stopPropagation();hS();mM.style.display='flex'});let bA$=mk('div','‚ú¥Ô∏è',IY);ev(bA$,'click',e=>{e.stopPropagation();hS();cM.style.display='flex'});ap(wA,bM,bA$,bD);ap(pd,wA);ap(a[0],pd,cM,mM);return a},uc=()=>E.forEach((el,i)=>el[0].style.background=H(i,50)),At=()=>(E.length=0,sl.length=0,pb.length=0,pb.push(...GB),U[4].replaceChildren(),s.forEach((a,i)=>{let b=L(i);E[i]=b;ap(U[4],b[0])}),z(),uc(),uW(),J(),(()=>{if(RM_T&&RM_I!==-1&&E[RM_I]){let sE$=E[RM_I][0],mC=RM_T==='mM'?'.menu-modifier':'.menu-ajouter',mE=sE$.querySelector(mC);if(mE){hS();mE.style.display='flex'}RM_T=null;RM_I=-1}})()),z=()=>W(U[5],`Configuration-${s.length-1} s√©quences-${T$()}s`),eA=async oP=>{let tD=T$();$cancelToken++;const cT=$cancelToken;if(tD<=0||s.length<=1)throw new Error('dur√©e nulle');let ts=~~(tD*SR),FP$=18200,FM=20,sC$=sC;try{oP(.05,'Initialisation');await wI();C$(cT);let fL=new Float32Array(ts),fR=new Float32Array(ts);for(let c=0;c<3;c++){let kS=c*2,iN=(sC$>=3)||(sC$===c);if(iN){C$(cT);let dC=await gD(ts,tD,s,kS,1,sC$===3?FC[c]:FC[3],cT,p=>oP(.1+c*.1+.1*p,`Signal ${['Rouge','Vert','Bleu'][c]}${~~(p*100)}%`));let mL=dC[0].f,mR=dC[1].f;for(let j=0;j<ts;j++){fL[j]+=mL[j];fR[j]+=mR[j]}await wI();C$(cT);}}oP(.4,'Encodage direct');await wI();C$(cT);let pP=tp*FP$/SR,pM=tp*FM/SR,AS=.25,AU=sC$<3?.1:.1/3,cS=16384,nC=~~((ts+cS-1)/cS),hW=44+ts*4,wA=new ArrayBuffer(hW),wV=new DataView(wA),ws=(o,s)=>[...s].forEach((c,i)=>wV.setUint8(o+i,c.charCodeAt(0)));ws(0,'RIFF');wV.setUint32(4,36+ts*4,1);ws(8,'WAVE');ws(12,'fmt ');wV.setUint32(16,16,1);wV.setUint16(20,1,1);wV.setUint16(22,2,1);wV.setUint32(24,SR,1);wV.setUint32(28,SR*4,1);wV.setUint16(32,4,1);wV.setUint16(34,16,1);ws(36,'data');wV.setUint32(40,ts*4,1);let wO=44,ph=Array(7).fill(0),wS=v=>{wV.setInt16(wO,v*32767|0,1);wO+=2};if(sC$===3){for(let ck=0;ck<nC;ck++){let st=ck*cS,ed=mi((ck+1)*cS,ts);for(let j=st;j<ed;j++){let cP=sn(ph[3]),m=sn(ph[4]);wS(fL[j]*AS+cP*AS*(1-m)*.5);wS(fR[j]*AS+cP*AS*(1+m)*.5);ph[3]+=pP;ph[3]>=tp&&(ph[3]-=tp);ph[4]+=pM;ph[4]>=tp&&(ph[4]-=tp)}!(ck%8)&&(await wI(),C$(cT),oP(.4+.5*((ck+1)/nC),`Encodage (Spectra): ${~~((ck+1)/nC*100)}%`));}}else{for(let ck=0;ck<nC;ck++){let st=ck*cS,ed=mi((ck+1)*cS,ts);for(let j=st;j<ed;j++){wS(fL[j]*AU);wS(fR[j]*AU)}!(ck%8)&&(await wI(),C$(cT),oP(.4+.5*((ck+1)/nC),`Encodage (${['Rouge','Vert','Bleu'][sC$]||'Unifi√©'}): ${~~((ck+1)/nC*100)}%`));}}oP(.9,'Finalisation');await wI();C$(cT);aP.src=URL.createObjectURL(new Blob([wA],{type:'audio/wav'}));oP(1,'Termin√©')}catch(er){if(er==='A')throw new Error('Op√©ration annul√©e.');throw er}},sC=0,aP,fC;U=['body','h1','h2','p','div','h2'].map(c);C(U[0],'padding-bottom:0;padding-top:0;');[U[1],U[3],K(),U[4],U[5]].forEach(el=>ap(U[0],el));ap(e,U[0]);Array.from({length:11},()=>s.push(rvS()));At();ev(window,'load',()=>{fC=mk('div','','position:sticky;bottom:0;left:0;right:0;z-index:998;width:100%;');let eU=mk('div','','position:relative;width:100%;padding:0.5vmin 1vmin;min-height:12vmin;background:#111;z-index:1000;'+D+'flex-direction:column;gap:1vmin;border-top:1px solid #f83;'),eR=mk('div','',D+'align-items:center;'+G1),cL=mk('label','',C1+'#000;'+D+'align-items:center;font-size:3vmin;gap:5px;height:5vmin;width:18vw;'),cS$=mk('select','','height:5vmin;background:#f83;color:white;'+BR+'font-size:3vmin;');ap(fC,mo);sC=3;['üî¥Rouge','üü¢Vert','üîµBleu','üåàSpectra','‚òÄÔ∏èUnifi√©',].forEach((n,i)=>{let o=mk('option',n,'');o.value=i;ap(cS$,o)});cS$.value=sC;ev(cS$,'change',e=>sC=parseInt(e.target.value));ap(cL,cS$);let bM=mk('div','',D+'align-items:center;');ap(bM,cL);let sP=(tx,ps)=>{let tp$=mk('div',tx,S9),cl=mk('div','‚ùå','position:absolute;top:1vmin;right:1vmin;'+IR);ev(cl,'click',()=>tp$.remove());ps&&ap(tp$,...ps);ap(tp$,cl);ap(d.body,tp$);setTimeout(()=>d.addEventListener('click',()=>tp$.parentNode&&tp$.remove(),{once:!0}),10)},tF=[mk('div',"‚à´T(X·µ¢)=X·µ¢.t+(X·µ¢‚Çä‚ÇÅ-X·µ¢)t¬≤/(2‚è≥)\nT(X·µ¢)=X·µ¢+(X·µ¢‚Çä‚ÇÅ-X·µ¢)t/‚è≥\nT'(X·µ¢)=(X·µ¢‚Çä‚ÇÅ-X·µ¢)/‚è≥ \nO·µ¢=‚à´T(üí´·µ¢)+T(‚ú®·µ¢)+O‚ÇÄ",C1+'#f90;'+S2),mk('div',"S·µ¢=sin(2œÄ‚ãÖœÜ·µ¢)\nœÜ·µ¢=‚à´T(üîî·µ¢)+T(‚ö°·µ¢)+œÜ‚ÇÄ+T(üåä)/T(üí´·µ¢)/4œÄ.sin(2œÄ‚ãÖO·µ¢)\nf·µ¢=T(üîî·µ¢)+T'(‚ö°·µ¢)+T(üåä·µ¢)/2.cos(2œÄ‚ãÖO·µ¢)\nk·µ¢=T'(üîî·µ¢)-T(üåä·µ¢).T(üí´·µ¢).œÄ.sin(2œÄ‚ãÖO·µ¢)",C1+'#f00;'+S2)],bL=mk('div','üí°',IB+'width:7vw;text-align:center;'+D+'align-items:center;justify-content:center;height:5vmin;');ev(bL,'click',e=>{e.stopPropagation();sP('',tF)});let eB=mk('button','üéµ G√©n√©rer','background:#4af;color:black;border:none;padding:1vmin 2vmin;'+BR+'font-size:3vmin;'+CU+'height:5vmin;position:relative;overflow:hidden;flex-grow:1;min-width:40vw;'),eBg=mk('div','','position:absolute;left:0;top:0;height:100%;width:0%;background:linear-gradient(90deg,#0f0,#4f4);transition:width 0.3s;z-index:0;'),eBt=mk('span','üéµ G√©n√©rer','position:relative;z-index:1;color:black;');ap(eB,eBg,eBt);let bS=mk('button','‚èπÔ∏è Stop','background:#f44;color:black;border:none;padding:1vmin 2vmin;'+BR+'font-size:3vmin;'+CU+'height:5vmin;width:15vw;position:relative;overflow:hidden;');ev(bS,'click',()=>{$cancelToken++;eBt.textContent='‚èπÔ∏è Annul√©';eBg.style.width='0%';eB.disabled=false;setTimeout(()=>{eBt.textContent='üéµ G√©n√©rer';},2000)});aP=mk('audio','',W1+'height:5vmin;');aP.controls=!0;ev(eB,'click',async()=>{eB.disabled=!1;eBg.style.width='0%';try{await eA((p,mg)=>{eBg.style.width=(p*100)+'%';eBt.textContent=mg?`‚è≥ ${~~(p*100)}% - ${mg}`:`‚è≥ ${~~(p*100)}%`});eBg.style.width='100%';eBt.textContent='‚úÖ Termin√©';setTimeout(()=>{eBt.textContent='üéµ G√©n√©rer';eBg.style.width='0%';eB.disabled=!1},2000)}catch(er){console.error(er);if(er.message!=='Op√©ration annul√©e.')eBt.textContent='‚èπÔ∏è Erreur';else eBt.textContent='‚èπÔ∏è Annul√©';setTimeout(()=>{eBt.textContent='üéµ G√©n√©rer';eBg.style.width='0%';eB.disabled=!1},2000)}});ap(eR,bL,bM,eB,bS);ap(eU,eR,aP);ap(fC,mo);ap(fC,eU);ap(d.body,fC);d.addEventListener('click',hS);At()});
</script>